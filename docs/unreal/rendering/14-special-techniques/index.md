# Ch.14 특수 렌더링 기법

볼류메트릭 효과, 데칼, 물 렌더링, 대기 시스템 등 특수 렌더링 기법을 다룹니다.

---

## 개요

특수 렌더링 기법은 사실적이고 몰입감 있는 환경을 만드는 데 핵심적인 역할을 합니다.

```
┌─────────────────────────────────────────────────────────────────┐
│                    특수 렌더링 기법 분류                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │                   볼류메트릭 효과                          │  │
│  │  ┌───────────┐  ┌───────────┐  ┌───────────┐            │  │
│  │  │ 볼류메트릭│  │  God Ray  │  │   구름    │            │  │
│  │  │    포그   │  │  (광선)   │  │           │            │  │
│  │  └───────────┘  └───────────┘  └───────────┘            │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │                   표면 효과                                │  │
│  │  ┌───────────┐  ┌───────────┐  ┌───────────┐            │  │
│  │  │   데칼    │  │   물/파도 │  │   눈/얼음 │            │  │
│  │  │           │  │           │  │           │            │  │
│  │  └───────────┘  └───────────┘  └───────────┘            │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │                   환경 효과                                │  │
│  │  ┌───────────┐  ┌───────────┐  ┌───────────┐            │  │
│  │  │ Sky       │  │  대기     │  │   날씨    │            │  │
│  │  │ Atmosphere│  │  산란     │  │  시스템   │            │  │
│  │  └───────────┘  └───────────┘  └───────────┘            │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 문서 구성

| 문서 | 주제 | 핵심 내용 |
|------|------|----------|
| [01](01-volumetric-rendering.md) | 볼류메트릭 렌더링 | 볼류메트릭 포그, God Ray, 라이트 샤프트 |
| [02](02-decals.md) | 데칼 시스템 | 디퍼드 데칼, 메시 데칼, 프로젝터 |
| [03](03-water-rendering.md) | 물 렌더링 | Water Body, 파동 시뮬레이션, 반사/굴절 |
| [04](04-atmosphere-sky.md) | 대기와 하늘 | Sky Atmosphere, 볼류메트릭 클라우드, 안개 |
| [05](05-special-effects.md) | 기타 특수 효과 | 서브서피스, 머리카락, 눈/얼음, 홀로그램 |

---

## 기술 개요

### 볼류메트릭 렌더링

```
┌─────────────────────────────────────────────────────────────────┐
│                   볼류메트릭 포그 파이프라인                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────┐     ┌─────────┐     ┌─────────┐     ┌─────────┐  │
│  │ Density │────▶│ Light   │────▶│ Scatter │────▶│ Compose │  │
│  │ Volume  │     │ Inject  │     │ Integrate│    │         │  │
│  └─────────┘     └─────────┘     └─────────┘     └─────────┘  │
│       │               │               │               │        │
│       ▼               ▼               ▼               ▼        │
│   3D Texture      Shadow        Ray March      Final Color    │
│   (Froxel)        Sampling       (누적)         (블렌딩)      │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 데칼 시스템

```
┌─────────────────────────────────────────────────────────────────┐
│                      데칼 렌더링 방식                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Deferred Decal:                                                │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │  G-Buffer ──▶ Decal Pass ──▶ Modified G-Buffer           │  │
│  │              (박스 투영)                                  │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                 │
│  DBuffer Decal:                                                 │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │  DBuffer ──▶ BasePass에서 샘플링 ──▶ G-Buffer            │  │
│  │  (별도 버퍼)                                              │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 물 렌더링

```
┌─────────────────────────────────────────────────────────────────┐
│                      물 렌더링 요소                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                     파동 시뮬레이션                       │    │
│  │  Gerstner Wave + FFT Ocean + Interactive Ripple         │    │
│  └───────────────────────────┬─────────────────────────────┘    │
│                              │                                  │
│                              ▼                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                     표면 셰이딩                          │    │
│  │  Normal Map + Fresnel + Specular + Subsurface           │    │
│  └───────────────────────────┬─────────────────────────────┘    │
│                              │                                  │
│                              ▼                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                    반사 / 굴절                           │    │
│  │  SSR + Planar Reflection + Refraction Offset            │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## UE5 주요 기능

### Sky Atmosphere

물리 기반 대기 산란 시뮬레이션으로 사실적인 하늘을 렌더링합니다.

```cpp
// 주요 파라미터
SkyAtmosphere->RayleighScattering = FLinearColor(0.0331, 0.0612, 0.1254);
SkyAtmosphere->MieScattering = FLinearColor(0.004);
SkyAtmosphere->AtmosphereHeight = 60.0f;  // km
```

### Volumetric Cloud

3D 볼륨 기반 실시간 구름 시스템입니다.

```cpp
// 구름 레이어 설정
VolumetricCloud->LayerBottomAltitude = 5.0f;  // km
VolumetricCloud->LayerHeight = 10.0f;
VolumetricCloud->TracingMaxDistance = 50.0f;
```

### Water System (UE5)

통합 물 시스템으로 강, 호수, 바다를 쉽게 구현합니다.

```cpp
// Water Body 설정
WaterBodyOcean->TargetWaveMaskDepth = 1000.0f;
WaterBodyOcean->MaxWaveHeightOffset = 150.0f;
```

---

## 성능 고려사항

| 기법 | 비용 수준 | 최적화 옵션 |
|------|----------|-------------|
| Volumetric Fog | 높음 | 해상도 조절, 거리 제한 |
| Deferred Decal | 낮음 | 정렬, 배칭 |
| Water Reflection | 높음 | SSR, 해상도 스케일 |
| Sky Atmosphere | 중간 | LUT 캐싱 |
| Volumetric Cloud | 높음 | 샘플 수, 거리 |

---

## 활성화 설정

```cpp
// 프로젝트 설정
r.VolumetricFog = 1
r.VolumetricCloud = 1
r.Water.SingleLayerWater = 1

// 품질 조절
r.VolumetricFog.GridPixelSize = 8  // 기본: 8
r.VolumetricFog.GridSizeZ = 64     // 깊이 슬라이스
r.VolumetricCloud.SampleMinimumCount = 2
```

---

## 참고 자료

- [Volumetric Effects](https://docs.unrealengine.com/volumetric-effects/)
- [Water System](https://docs.unrealengine.com/water-system/)
- [Sky and Atmosphere](https://docs.unrealengine.com/sky-atmosphere/)
