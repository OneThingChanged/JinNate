# 광학 보정

렌즈 왜곡, 색수차 보정 기술을 설명합니다.

---

## VR 렌즈의 왜곡

VR 렌즈는 넓은 시야각을 위해 사용되지만 왜곡을 유발합니다.

```
┌─────────────────────────────────────────────────────────────────┐
│                    렌즈 왜곡 유형                                 │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  1. Barrel Distortion (배럴 왜곡)                               │
│                                                                 │
│     원본 이미지:          렌즈를 통해 보이는 이미지:            │
│     ┌─────────┐          ┌─────────┐                           │
│     │ ┌─────┐ │          │  ╭───╮  │                           │
│     │ │     │ │    →     │ ╭│   │╮ │                           │
│     │ │     │ │          │ │╰───╯│ │                           │
│     │ └─────┘ │          │  ╰───╯  │                           │
│     └─────────┘          └─────────┘                           │
│                                                                 │
│     중앙은 확대, 가장자리는 압축됨                              │
│                                                                 │
│  2. Pincushion Distortion (핀쿠션 왜곡)                         │
│                                                                 │
│     ┌─────────┐          ┌─────────┐                           │
│     │ ┌─────┐ │          │ ╭─────╮ │                           │
│     │ │     │ │    →     │╭│     │╮│                           │
│     │ │     │ │          │╰│     │╯│                           │
│     │ └─────┘ │          │ ╰─────╯ │                           │
│     └─────────┘          └─────────┘                           │
│                                                                 │
│     중앙은 축소, 가장자리는 확대됨                              │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 왜곡 보정 원리

렌즈 왜곡의 역변환을 렌더링에 적용합니다.

```
┌─────────────────────────────────────────────────────────────────┐
│                    왜곡 보정 과정                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  1. 원본 렌더링                                                 │
│     ┌─────────┐                                                │
│     │ ┌─────┐ │  정상적인 렌더링 결과                          │
│     │ │     │ │                                                │
│     │ └─────┘ │                                                │
│     └─────────┘                                                │
│           │                                                     │
│           ▼                                                     │
│  2. 역왜곡 적용 (Pincushion 변환)                               │
│     ┌─────────┐                                                │
│     │ ╭─────╮ │  의도적으로 핀쿠션 왜곡 적용                   │
│     │╭│     │╮│                                                │
│     │╰│     │╯│                                                │
│     │ ╰─────╯ │                                                │
│     └─────────┘                                                │
│           │                                                     │
│           ▼                                                     │
│  3. 렌즈를 통해 봄                                              │
│     ┌─────────┐                                                │
│     │ ┌─────┐ │  배럴 왜곡 + 핀쿠션 = 정상!                   │
│     │ │     │ │                                                │
│     │ └─────┘ │                                                │
│     └─────────┘                                                │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 색수차 (Chromatic Aberration)

파장별로 굴절률이 달라 색 분리가 발생합니다.

```
┌─────────────────────────────────────────────────────────────────┐
│                    색수차 현상                                   │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│              빛                                                 │
│               │                                                 │
│               ▼                                                 │
│          ╱─────────╲    렌즈                                   │
│         ╱           ╲                                           │
│        │             │                                          │
│         ╲           ╱                                           │
│          ╲─────────╱                                           │
│              │╲ ╲                                               │
│              │ ╲ ╲                                              │
│              │  ╲ ╲                                             │
│              │   ╲ ╲                                            │
│             빨   녹 파                                          │
│             강   색 랑                                          │
│                                                                 │
│  빨간색: 가장 적게 굴절                                         │
│  파란색: 가장 많이 굴절                                         │
│                                                                 │
│  결과: 가장자리에서 무지개 색 번짐                              │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 색수차 보정

각 색상 채널에 다른 UV 좌표를 적용합니다.

```hlsl
// 색수차 보정 셰이더
float2 distortUV(float2 uv, float k)
{
    float2 centered = uv - 0.5;
    float r2 = dot(centered, centered);
    float distortion = 1.0 + k * r2;
    return centered * distortion + 0.5;
}

void main()
{
    // 각 채널별 다른 왜곡 계수
    float kRed = 0.02;
    float kGreen = 0.0;
    float kBlue = -0.02;

    float3 color;
    color.r = texture(inputTex, distortUV(uv, kRed)).r;
    color.g = texture(inputTex, distortUV(uv, kGreen)).g;
    color.b = texture(inputTex, distortUV(uv, kBlue)).b;

    fragColor = float4(color, 1.0);
}
```

---

## Hidden Area Mesh

렌즈 광학계로 인해 보이지 않는 영역을 렌더링에서 제외합니다.

```
┌─────────────────────────────────────────────────────────────────┐
│                    Hidden Area Mesh                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  디스플레이 영역:                  실제 가시 영역:              │
│  ┌─────────────────┐              ┌─────────────────┐          │
│  │░░░░░░░░░░░░░░░░░│              │░░░         ░░░░░│          │
│  │░░░░░░░░░░░░░░░░░│              │░░   ╭───╮   ░░░│          │
│  │░░░░░░░░░░░░░░░░░│      →       │░   ╱     ╲   ░░│          │
│  │░░░░░░░░░░░░░░░░░│              │   │       │   ░│          │
│  │░░░░░░░░░░░░░░░░░│              │░   ╲     ╱   ░░│          │
│  │░░░░░░░░░░░░░░░░░│              │░░   ╰───╯   ░░░│          │
│  │░░░░░░░░░░░░░░░░░│              │░░░         ░░░░░│          │
│  └─────────────────┘              └─────────────────┘          │
│                                                                 │
│  ░ = 렌더링 불필요 영역                                        │
│                                                                 │
│  최적화 효과:                                                   │
│  • 픽셀 셰이딩 약 17% 감소                                     │
│  • Early-Z로 제외                                              │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 다음 단계

[UE XR 구현](05-ue-xr-implementation.md)에서 UE의 XR 지원을 알아봅니다.
