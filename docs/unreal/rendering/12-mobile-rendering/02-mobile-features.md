# UE 모바일 기능

UE 모바일 렌더러의 8가지 핵심 기능을 상세히 설명합니다.

---

## 1. Feature Level 지원

### 지원 API

| API | 플랫폼 | 특징 |
|-----|--------|------|
| **OpenGL ES 3.1** | Android | 넓은 호환성 |
| **Vulkan** | Android | 낮은 오버헤드, 멀티스레딩 |
| **Metal** | iOS | Apple 최적화 |

### Feature Level 설정

```cpp
// Project Settings에서 설정
// 또는 DefaultEngine.ini
[/Script/Engine.RendererSettings]
r.Mobile.FeatureLevel=ES31

// Vulkan 강제 사용
r.Vulkan.EnableValidation=0
r.Android.DisableVulkanSupport=False
```

```
┌─────────────────────────────────────────────────────────────────┐
│                    Feature Level 계층                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ES3_1 (기본)                                                   │
│  ├── Compute Shader 지원                                       │
│  ├── Instancing                                                │
│  ├── MRT (4 targets)                                           │
│  └── sRGB 텍스처                                               │
│                                                                 │
│  Vulkan                                                         │
│  ├── ES3_1 기능 모두 포함                                      │
│  ├── 멀티스레드 커맨드 빌드                                    │
│  ├── Subpass 지원                                              │
│  └── 더 나은 성능                                              │
│                                                                 │
│  Metal                                                          │
│  ├── iOS 전용                                                  │
│  ├── Tile Shader 지원                                          │
│  ├── Argument Buffer                                           │
│  └── Apple Silicon 최적화                                      │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 2. Deferred Shading

UE 4.26부터 모바일에서도 Deferred Shading을 지원합니다.

### 활성화

```cpp
// 콘솔 변수
r.Mobile.ShadingPath=1  // 0: Forward, 1: Deferred

// Project Settings
Mobile Shading Path = Mobile Deferred
```

### 모바일 Deferred의 특징

```
┌─────────────────────────────────────────────────────────────────┐
│                    모바일 Deferred 구조                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  G-Buffer (128-bit, 타일 메모리 최적화)                         │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ RT0: BaseColor.rgb + Metallic                           │   │
│  │ RT1: WorldNormal.xyz + Specular                         │   │
│  │ RT2: (선택적 추가 데이터)                                │   │
│  │ Depth: 24-bit Depth + 8-bit Stencil                     │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  Forward 대비 장점:                                             │
│  • 많은 동적 광원 효율적 처리                                  │
│  • 복잡한 머티리얼도 일정한 비용                               │
│                                                                 │
│  제약:                                                          │
│  • MSAA 사용 불가 (TAA 권장)                                   │
│  • 투명 오브젝트는 Forward로 처리                              │
│  • G-Buffer 대역폭                                             │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 3. GTAO (Ground Truth Ambient Occlusion)

### 개요

화면 공간 앰비언트 오클루전으로, 간접광에 의한 부드러운 그림자를 제공합니다.

```cpp
// 활성화
r.Mobile.AmbientOcclusion=1
r.Mobile.AmbientOcclusionQuality=1  // 0: Low, 1: Medium, 2: High
```

```
┌─────────────────────────────────────────────────────────────────┐
│                    GTAO 처리 과정                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  1. Depth 기반 AO 계산                                          │
│     ┌─────────────────────────────────────────────────────┐    │
│     │ 주변 깊이 샘플링 → 차폐 계산 → AO Factor            │    │
│     └─────────────────────────────────────────────────────┘    │
│                           │                                     │
│                           ▼                                     │
│  2. Spatial/Temporal 필터                                       │
│     ┌─────────────────────────────────────────────────────┐    │
│     │ 노이즈 제거 → 블러 → 시간적 누적                    │    │
│     └─────────────────────────────────────────────────────┘    │
│                           │                                     │
│                           ▼                                     │
│  3. 라이팅에 적용                                               │
│     ┌─────────────────────────────────────────────────────┐    │
│     │ Indirect Lighting × AO Factor                       │    │
│     └─────────────────────────────────────────────────────┘    │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 4. Dynamic Lighting

### 지원 광원

| 광원 타입 | 최대 개수 | 그림자 |
|----------|----------|--------|
| **Directional** | 1 | CSM 지원 |
| **Point** | 4 | 지원 |
| **Spot** | 4 | 지원 |

### Cascaded Shadow Maps (CSM)

```
┌─────────────────────────────────────────────────────────────────┐
│                    모바일 CSM 구성                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  카메라 ──────────▶ 시야 방향                                  │
│                                                                 │
│  ┌─────┬──────┬────────┬──────────────┐                        │
│  │ C0  │  C1  │   C2   │     C3       │                        │
│  │근거리│      │        │   원거리    │                        │
│  └─────┴──────┴────────┴──────────────┘                        │
│                                                                 │
│  모바일 권장 설정:                                              │
│  • Cascade 수: 2~3개                                           │
│  • Shadow Resolution: 1024 또는 2048                           │
│  • Dynamic Shadow Distance: 조절 필요                          │
│                                                                 │
│  r.Shadow.CSM.MaxCascades=3                                    │
│  r.Shadow.MaxResolution=1024                                   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 5. Pixel Projected Reflection (PPR)

### 특징

화면 공간 반사의 모바일 최적화 버전입니다.

```cpp
// 활성화
r.Mobile.PixelProjectedReflection=1
```

```
┌─────────────────────────────────────────────────────────────────┐
│                    PPR vs SSR 비교                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  SSR (Screen Space Reflection)                                  │
│  • Ray marching 기반                                           │
│  • 높은 품질, 높은 비용                                        │
│  • 데스크톱용                                                  │
│                                                                 │
│  PPR (Pixel Projected Reflection)                               │
│  • 픽셀 투영 기반                                              │
│  • 평면 반사에 최적화                                          │
│  • 모바일 최적화                                               │
│  • 제한된 정확도                                               │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 6. Mesh Auto-Instancing

### GPU Scene 지원

```cpp
// 활성화
r.Mobile.SupportGPUScene=1
```

```
┌─────────────────────────────────────────────────────────────────┐
│                    Auto-Instancing 동작                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  동일 메시 여러 인스턴스:                                       │
│                                                                 │
│  Without Instancing:                                            │
│  Draw(Mesh, Transform1)                                        │
│  Draw(Mesh, Transform2)                                        │
│  Draw(Mesh, Transform3)  → 3번의 Draw Call                     │
│                                                                 │
│  With Auto-Instancing:                                          │
│  DrawInstanced(Mesh, [T1,T2,T3])  → 1번의 Draw Call           │
│                                                                 │
│  요구사항:                                                      │
│  • 동일한 메시                                                  │
│  • 동일한 머티리얼 (파라미터 제외)                             │
│  • 인스턴싱 가능한 셰이더                                      │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 7. Post Processing

### 모바일 지원 효과

| 효과 | 지원 | 성능 영향 |
|------|------|----------|
| **Bloom** | O | 중간 |
| **TAA** | O | 낮음~중간 |
| **Tone Mapping** | O | 낮음 |
| **Vignette** | O | 낮음 |
| **Color Grading** | O | 낮음 |
| **DOF** | 제한적 | 높음 |
| **Motion Blur** | 제한적 | 높음 |

### Mobile HDR 요구사항

```cpp
// Mobile HDR 필수 설정
r.Mobile.HDR=1
r.Mobile.TonemapperFilm=1

// Post Process 품질
r.Mobile.PostProcessQuality=1  // 0: Low, 1: Medium, 2: High
```

```
┌─────────────────────────────────────────────────────────────────┐
│                    모바일 Post Process 파이프라인                │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Scene Color (HDR)                                              │
│       │                                                         │
│       ▼                                                         │
│  ┌─────────────┐                                               │
│  │   Bloom     │ ← 다운샘플 + 블러 + 업샘플                    │
│  └──────┬──────┘                                               │
│         │                                                       │
│         ▼                                                       │
│  ┌─────────────┐                                               │
│  │    TAA      │ ← 시간적 안티에일리어싱                       │
│  └──────┬──────┘                                               │
│         │                                                       │
│         ▼                                                       │
│  ┌─────────────┐                                               │
│  │ Tone Mapping│ ← HDR → SDR 변환                              │
│  └──────┬──────┘                                               │
│         │                                                       │
│         ▼                                                       │
│  Final Output (LDR)                                             │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 8. Material 기능

### 지원 속성

```
┌─────────────────────────────────────────────────────────────────┐
│                    모바일 Material 속성                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  지원 속성:                                                     │
│  • Base Color                                                  │
│  • Roughness                                                   │
│  • Metallic                                                    │
│  • Normal                                                      │
│  • Emissive                                                    │
│  • Opacity (Masked/Translucent)                                │
│                                                                 │
│  제한:                                                          │
│  • Texture Sampler: 최대 16개                                  │
│  • 복잡한 노드 연산 제한                                       │
│  • Subsurface 제한적 지원                                      │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 텍스처 패킹

```
┌─────────────────────────────────────────────────────────────────┐
│                    텍스처 채널 패킹 예시                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  비효율적 (4개 텍스처):                                         │
│  • BaseColor.rgb                                               │
│  • Roughness (grayscale)                                       │
│  • Metallic (grayscale)                                        │
│  • AO (grayscale)                                              │
│                                                                 │
│  효율적 (2개 텍스처):                                           │
│  • Texture1: BaseColor.rgb                                     │
│  • Texture2.r: Roughness                                       │
│  • Texture2.g: Metallic                                        │
│  • Texture2.b: AO                                              │
│                                                                 │
│  샘플러 사용량 50% 절감!                                        │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 다음 단계

[Forward 렌더링](03-forward-rendering.md)에서 모바일 Forward 파이프라인을 알아봅니다.
