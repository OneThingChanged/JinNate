# 모바일 렌더링 개요

모바일 디바이스의 특성과 제약, GPU 아키텍처를 설명합니다.

---

## 모바일 디바이스 특성

### 데스크톱과의 차이점

```
┌─────────────────────────────────────────────────────────────────┐
│                 데스크톱 vs 모바일 비교                          │
├─────────────────────────┬───────────────────────────────────────┤
│       데스크톱          │              모바일                    │
├─────────────────────────┼───────────────────────────────────────┤
│ 전력: 수백 W            │ 전력: 5W 이하                         │
│ 능동 냉각 (팬)          │ 수동 냉각 (방열판)                    │
│ 전용 VRAM              │ 통합 메모리 (Unified Memory)          │
│ IMR 아키텍처           │ TBDR 아키텍처                         │
│ 높은 대역폭            │ 제한된 대역폭                         │
│ 성능 우선              │ 전력 효율 우선                        │
└─────────────────────────┴───────────────────────────────────────┘
```

### 주요 제약 요소

| 제약 | 설명 | 영향 |
|------|------|------|
| **전력** | 배터리 용량 제한, 5W 이하 | 연산량 제한 |
| **발열** | 열 스로틀링 | 지속 성능 저하 |
| **대역폭** | 메모리 대역폭 10~30 GB/s | 텍스처 접근 제한 |
| **ALU** | PC 대비 1/10~1/50 | 셰이더 복잡도 제한 |
| **메모리** | 2~8 GB 공유 메모리 | 해상도/품질 제한 |

---

## IMR vs TBDR 아키텍처

### IMR (Immediate Mode Rendering)

데스크톱 GPU가 사용하는 방식입니다.

```
┌─────────────────────────────────────────────────────────────────┐
│                    IMR 렌더링 방식                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Draw Call 1    Draw Call 2    Draw Call 3                     │
│      │              │              │                           │
│      ▼              ▼              ▼                           │
│  ┌──────┐       ┌──────┐       ┌──────┐                        │
│  │ VS   │       │ VS   │       │ VS   │                        │
│  └──┬───┘       └──┬───┘       └──┬───┘                        │
│     │              │              │                             │
│     ▼              ▼              ▼                             │
│  ┌──────┐       ┌──────┐       ┌──────┐                        │
│  │ PS   │       │ PS   │       │ PS   │                        │
│  └──┬───┘       └──┬───┘       └──┬───┘                        │
│     │              │              │                             │
│     ▼              ▼              ▼                             │
│  ═══════════════════════════════════════                       │
│           Frame Buffer (VRAM)                                   │
│  ═══════════════════════════════════════                       │
│                                                                 │
│  • 각 Draw Call이 즉시 Frame Buffer에 기록                     │
│  • 높은 대역폭 필요                                            │
│  • Overdraw 비용이 큼                                          │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### TBDR (Tile-Based Deferred Rendering)

모바일 GPU가 사용하는 방식입니다.

```
┌─────────────────────────────────────────────────────────────────┐
│                    TBDR 렌더링 방식                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  1단계: Binning (지오메트리 처리)                               │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  모든 Draw Call → VS → 타일 리스트 생성                  │   │
│  │                                                         │   │
│  │  화면 분할:  ┌───┬───┬───┬───┐                          │   │
│  │             │ T0│ T1│ T2│ T3│                          │   │
│  │             ├───┼───┼───┼───┤                          │   │
│  │             │ T4│ T5│ T6│ T7│                          │   │
│  │             └───┴───┴───┴───┘                          │   │
│  │                                                         │   │
│  │  각 타일에 영향을 주는 삼각형 목록 저장                  │   │
│  └─────────────────────────────────────────────────────────┘   │
│                           ▼                                     │
│  2단계: Rendering (타일별 처리)                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  타일 T0:                                               │   │
│  │  ┌─────────────────────────────┐                        │   │
│  │  │    On-Chip Tile Memory      │ ← 빠른 접근            │   │
│  │  │  ┌─────┐ ┌─────┐ ┌─────┐   │                        │   │
│  │  │  │Color│ │Depth│ │Stencil│  │                        │   │
│  │  │  └─────┘ └─────┘ └─────┘   │                        │   │
│  │  └─────────────────────────────┘                        │   │
│  │  • HSR로 가려진 픽셀 제거                               │   │
│  │  • 보이는 픽셀만 셰이딩                                 │   │
│  └─────────────────────────────────────────────────────────┘   │
│                           ▼                                     │
│  3단계: Resolve (메모리 기록)                                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  타일 결과 → 압축 → Frame Buffer (System Memory)        │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 주요 모바일 GPU 제조사

### GPU별 특성

| GPU | 제조사 | 특징 |
|-----|--------|------|
| **Adreno** | Qualcomm | FlexRender (하이브리드), UBWC 압축 |
| **Mali** | ARM | Bifrost/Valhall 아키텍처, AFBC 압축 |
| **PowerVR** | Imagination | HSR 최적화, PVRTC 압축 |
| **Apple GPU** | Apple | Metal 최적화, ASTC 지원 |

### 타일 크기

```
┌─────────────────────────────────────────────────────────────────┐
│                    GPU별 타일 크기                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Adreno:    가변 (FlexRender에 따라)                           │
│  Mali:      16x16 픽셀                                         │
│  PowerVR:   32x32 픽셀                                         │
│  Apple:     32x32 픽셀                                         │
│                                                                 │
│  타일 크기에 따른 메모리:                                       │
│  • 16x16 × RGBA8 = 1KB                                         │
│  • 32x32 × RGBA8 = 4KB                                         │
│  • 32x32 × RGBA16F = 8KB                                       │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## TBDR의 장단점

### 장점

```
┌─────────────────────────────────────────────────────────────────┐
│                    TBDR 장점                                     │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  1. 대역폭 절감                                                 │
│     • Frame Buffer 접근이 타일 단위로 집중                     │
│     • On-Chip 메모리에서 대부분 처리                           │
│     • 최대 70-80% 대역폭 절감 가능                             │
│                                                                 │
│  2. Overdraw 최소화                                             │
│     • HSR (Hidden Surface Removal)                             │
│     • 최종적으로 보이는 픽셀만 셰이딩                          │
│     • 깊이 복잡도와 무관한 셰이딩 비용                         │
│                                                                 │
│  3. 전력 효율                                                   │
│     • 적은 메모리 접근 = 적은 전력 소비                        │
│     • 모바일 디바이스에 최적화                                 │
│                                                                 │
│  4. MSAA 효율성                                                 │
│     • 타일 내에서 MSAA 수행                                    │
│     • Resolve 비용 최소화                                      │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 단점

```
┌─────────────────────────────────────────────────────────────────┐
│                    TBDR 단점                                     │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  1. Binning 오버헤드                                            │
│     • 지오메트리 정보를 메모리에 저장해야 함                   │
│     • 많은 삼각형 시 병목                                      │
│                                                                 │
│  2. Alpha Test/Discard 비용                                     │
│     • HSR 최적화 무효화                                        │
│     • 픽셀 순서 보장 필요                                      │
│                                                                 │
│  3. Frame Buffer 읽기 비용                                      │
│     • 이전 프레임 데이터 필요 시 전체 로드                     │
│     • Dependent texture read 문제                              │
│                                                                 │
│  4. 지오메트리 제한                                             │
│     • 타일당 삼각형 수 제한                                    │
│     • 복잡한 장면에서 성능 저하                                │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 대역폭 절감 기술

### 압축 기술

| 기술 | GPU | 효과 |
|------|-----|------|
| **UBWC** | Adreno | 최대 50% 대역폭 절감 |
| **AFBC** | Mali | 최대 50% 대역폭 절감 |
| **PVRTC** | PowerVR | 텍스처 압축 |
| **ASTC** | 공통 | 0.89~8 bpp 가변 압축 |

### Transaction Elimination

동일한 타일 내용이 이전 프레임과 같으면 기록을 생략합니다.

```
┌─────────────────────────────────────────────────────────────────┐
│                    Transaction Elimination                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Frame N-1            Frame N              결과                 │
│  ┌───┬───┬───┐       ┌───┬───┬───┐                             │
│  │ A │ B │ C │       │ A │ B'│ C │       B만 기록              │
│  ├───┼───┼───┤       ├───┼───┼───┤       (A, C 생략)           │
│  │ D │ E │ F │       │ D │ E │ F │                             │
│  └───┴───┴───┘       └───┴───┴───┘                             │
│                                                                 │
│  • 타일 CRC 비교                                               │
│  • 변경된 타일만 메모리 기록                                   │
│  • UI나 정적 장면에서 큰 효과                                  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 다음 단계

[UE 모바일 기능](02-mobile-features.md)에서 UE의 8가지 핵심 모바일 기능을 알아봅니다.
