# 트러블슈팅 가이드

일반적인 렌더링 문제와 해결 방법을 정리합니다.

---

## 일반적인 렌더링 문제

```
┌─────────────────────────────────────────────────────────────────┐
│                Common Rendering Issues                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  시각적 아티팩트:                                               │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  증상                    가능한 원인                     │   │
│  │  ─────────────────────────────────────────────────────  │   │
│  │  Z-Fighting            오브젝트 겹침, 바이어스 부족      │   │
│  │  블랙 스크린           셰이더 오류, 렌더타겟 문제       │   │
│  │  텍스처 깜빡임         밉맵 문제, 스트리밍 이슈         │   │
│  │  그림자 끊김           캐스케이드 설정, 해상도          │   │
│  │  반짝임/스파클         노멀맵, 스페큘러 문제            │   │
│  │  밴딩                  색상 정밀도, 압축               │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  성능 문제:                                                     │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  증상                    가능한 원인                     │   │
│  │  ─────────────────────────────────────────────────────  │   │
│  │  낮은 FPS              CPU/GPU 병목, 드로우콜 과다      │   │
│  │  히칭/스터터링         GC, 스트리밍, 셰이더 컴파일      │   │
│  │  메모리 부족           텍스처 과다, 스트리밍 풀         │   │
│  │  긴 로딩 시간          에셋 크기, 셰이더 컴파일         │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## Z-Fighting 해결

```
┌─────────────────────────────────────────────────────────────────┐
│                   Z-Fighting Solutions                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  증상: 겹친 표면에서 깜빡이는 패턴                              │
│                                                                 │
│  원인:                                                          │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  두 표면이 거의 동일한 깊이에 위치                       │   │
│  │  → 깊이 버퍼 정밀도 부족으로 어느 것이 앞인지 결정 불가 │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  해결책:                                                        │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  1. 오브젝트 간격 두기 (권장)                            │   │
│  │     최소 0.1-1.0 유닛 이상 분리                         │   │
│  │                                                          │   │
│  │  2. Depth Bias 사용                                      │   │
│  │     머티리얼의 Depth Bias 값 조정                       │   │
│  │                                                          │   │
│  │  3. 카메라 Near Clip 조정                               │   │
│  │     Near Clip을 크게 (단, 가까운 오브젝트 클리핑 주의) │   │
│  │                                                          │   │
│  │  4. Reverse-Z 확인                                       │   │
│  │     r.ReverseZ = 1 (기본값, 권장)                       │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### Z-Fighting 해결 코드

```cpp
// 머티리얼에서 Depth Bias 설정
// Material Editor에서 Details → Material → Depth Bias

// 데칼에서 Sort Order 설정
UPROPERTY(EditAnywhere, Category = "Decal")
int32 SortOrder = 0;  // 높을수록 앞에 렌더링

// 카메라 Near/Far Clip 조정
UPROPERTY(EditAnywhere, Category = "Camera")
float OrthoNearClipPlane = 10.0f;

// 프로젝트 설정
// r.NearClipPlane=10 (기본값)
// 값이 클수록 Z 정밀도 향상, 너무 크면 가까운 오브젝트 클리핑
```

---

## 셰이더 오류 해결

```
┌─────────────────────────────────────────────────────────────────┐
│                   Shader Error Debugging                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  일반적인 셰이더 오류:                                          │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  오류 메시지              해결책                         │   │
│  │  ─────────────────────────────────────────────────────  │   │
│  │  "Shader compile error"  셰이더 코드 확인, 로그 검토    │   │
│  │  "Missing parameter"     파라미터 바인딩 확인           │   │
│  │  "Too many textures"     텍스처 샘플러 수 줄이기        │   │
│  │  "Instruction limit"     셰이더 복잡도 줄이기           │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  디버깅 단계:                                                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  1. Output Log에서 셰이더 오류 확인                      │   │
│  │  2. r.ShaderDevelopmentMode=1 활성화                    │   │
│  │  3. recompileshaders changed 로 재컴파일                │   │
│  │  4. 문제 노드 바이패스하며 원인 찾기                    │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 셰이더 디버깅

```cpp
// 셰이더 개발 모드 활성화
r.ShaderDevelopmentMode=1           // 런타임 셰이더 재컴파일 허용
r.DumpShaderDebugInfo=1             // 셰이더 디버그 정보 덤프
r.DumpShaderDebugShortNames=1       // 짧은 파일명 사용

// 셰이더 재컴파일
recompileshaders all                // 모든 셰이더
recompileshaders changed            // 변경된 셰이더만
recompileshaders material MyMat     // 특정 머티리얼

// 셰이더 디버그 파일 위치
// Saved/ShaderDebugInfo/

// GPU 크래시 디버깅
r.GPUCrashDebugging=1               // GPU 크래시 추적
r.D3D12.GPUCrashDebugging=2         // D3D12 상세 디버깅

// 셰이더 캐시 무효화
r.ShaderPipelineCache.Enabled=0     // 캐시 비활성화 (디버깅용)

// 에러 발생 시 확인할 로그 카테고리
// LogShaders
// LogShaderCompilers
// LogMaterial
```

---

## 메모리 문제 해결

```
┌─────────────────────────────────────────────────────────────────┐
│                   Memory Issue Solutions                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Out of Memory 진단:                                            │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  1. stat memory로 메모리 사용량 확인                     │   │
│  │  2. memreport -full로 상세 리포트                       │   │
│  │  3. obj list로 오브젝트별 메모리 확인                   │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  일반적인 원인:                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  • 텍스처 스트리밍 풀 부족                               │   │
│  │  • 고해상도 텍스처 과다                                  │   │
│  │  • 메모리 누수                                           │   │
│  │  • 레벨 스트리밍 미설정                                  │   │
│  │  • 버퍼 과다 할당                                        │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  해결책:                                                        │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  • r.Streaming.PoolSize 증가                            │   │
│  │  • 텍스처 해상도 제한 (MaxTextureSize)                  │   │
│  │  • 텍스처 압축 최적화                                    │   │
│  │  • 레벨 스트리밍 구현                                    │   │
│  │  • 미사용 에셋 정리                                      │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 메모리 디버깅

```cpp
// 메모리 통계 확인
stat memory                         // 기본 메모리 통계
stat memoryplatform                 // 플랫폼별 메모리
stat streaming                      // 스트리밍 메모리
stat streamingdetails              // 스트리밍 상세

// 메모리 리포트
memreport                          // 기본 리포트
memreport -full                    // 상세 리포트

// 오브젝트 목록
obj list class=Texture2D           // 텍스처 메모리
obj list class=StaticMesh          // 메시 메모리
obj list class=Material            // 머티리얼 메모리

// 가비지 컬렉션
obj gc                             // GC 실행

// 스트리밍 풀 조정
r.Streaming.PoolSize=1000          // MB 단위
r.Streaming.MaxTempMemoryAllowed=50

// 텍스처 메모리 제한
r.MaxAnisotropy=4                  // 이방성 필터링 제한
r.Streaming.MipBias=1              // 밉맵 바이어스

// 메모리 누수 추적
MemLeakCheck Start                 // 추적 시작
// ... 게임플레이 ...
MemLeakCheck Stop                  // 추적 종료 및 리포트
```

---

## 성능 문제 해결

```
┌─────────────────────────────────────────────────────────────────┐
│                Performance Issue Solutions                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  병목 식별:                                                     │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  stat unit 결과 해석:                                    │   │
│  │                                                          │   │
│  │  Frame: 20ms                                             │   │
│  │  Game:  15ms  ◄── CPU 병목 (Game Thread)               │   │
│  │  Draw:   5ms                                             │   │
│  │  GPU:   18ms  ◄── GPU 병목                              │   │
│  │                                                          │   │
│  │  가장 큰 값이 병목                                       │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  CPU 병목 해결:                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  • 드로우콜 감소 (배칭, 인스턴싱, LOD)                  │   │
│  │  • Tick 최적화 (불필요한 틱 비활성화)                   │   │
│  │  • 가시성 컬링 최적화                                    │   │
│  │  • 애니메이션/물리 최적화                                │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  GPU 병목 해결:                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  • 셰이더 복잡도 감소                                    │   │
│  │  • 해상도 감소 또는 동적 해상도                          │   │
│  │  • 포스트 프로세스 최적화                                │   │
│  │  • 오버드로 감소                                         │   │
│  │  • 그림자 품질 조정                                      │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 성능 디버깅

```cpp
// 기본 성능 확인
stat fps                           // FPS
stat unit                          // 스레드별 시간
stat unitgraph                     // 그래프로 표시

// GPU 분석
stat gpu                           // GPU 패스별 시간
ProfileGPU                         // GPU 프로파일 캡처

// CPU 분석
stat game                          // 게임 스레드
stat scenerendering               // 렌더링 스레드

// 드로우콜 확인
stat rhi                           // DrawPrimitive 호출 수
stat scenerendering               // 메시 드로우 콜

// 빠른 성능 토글
// 원인 파악을 위해 기능 비활성화
Show PostProcessing               // 포스트 프로세스 토글
Show DynamicShadows              // 그림자 토글
Show Particles                    // 파티클 토글
Show Foliage                      // 폴리지 토글

// 스케일러빌리티 조정
sg.ShadowQuality=0               // 그림자 끄기
sg.PostProcessQuality=0          // PP 끄기
sg.EffectsQuality=0              // 이펙트 끄기
```

---

## 일반적인 문제 체크리스트

```
┌─────────────────────────────────────────────────────────────────┐
│                  Troubleshooting Checklist                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  렌더링이 안 될 때:                                             │
│  □ 셰이더 컴파일 오류 확인 (Output Log)                         │
│  □ 머티리얼 할당 확인                                           │
│  □ 가시성 설정 확인 (Hidden, Visibility)                        │
│  □ 컬링 설정 확인 (CullDistance, FrustumCulling)               │
│  □ 레이어/채널 확인                                             │
│                                                                 │
│  성능이 나쁠 때:                                                │
│  □ stat unit으로 병목 확인                                      │
│  □ stat gpu로 GPU 패스 확인                                     │
│  □ ProfileGPU로 상세 분석                                       │
│  □ 드로우콜 수 확인 (stat rhi)                                  │
│  □ 오버드로 확인 (ViewMode QuadOverdraw)                        │
│                                                                 │
│  크래시 발생 시:                                                │
│  □ 로그 파일 확인 (Saved/Logs)                                  │
│  □ 크래시 덤프 분석                                             │
│  □ GPU 크래시 디버깅 활성화                                     │
│  □ 최근 변경 사항 롤백 테스트                                   │
│                                                                 │
│  빌드 오류 시:                                                  │
│  □ Derived Data Cache 삭제                                      │
│  □ Intermediate 폴더 삭제                                       │
│  □ 셰이더 캐시 삭제 (Saved/ShaderCache)                        │
│  □ Clean 후 재빌드                                              │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 유용한 디버그 명령어 모음

```cpp
// 렌더링 상태 확인
r.ScreenPercentage              // 현재 해상도 스케일
r.DynamicRes.OperationMode      // 동적 해상도 모드
r.Shadow.MaxResolution          // 그림자 해상도

// 강제 설정
FreezeRendering                 // 렌더링 프리즈
ToggleDebugCamera              // 디버그 카메라

// 리소스 확인
ListTextures                    // 로드된 텍스처 목록
ListStaticMeshes               // 로드된 스태틱 메시
ListMaterials                   // 로드된 머티리얼

// 클리어/리셋
FlushPersistentDebugLines      // 디버그 라인 클리어
obj gc                          // 가비지 컬렉션

// 스크린샷/녹화
Shot                            // 스크린샷
HighResShot 4                   // 4배 해상도 스크린샷
StartMovieCapture              // 비디오 녹화 시작
StopMovieCapture               // 비디오 녹화 종료
```

---

## 참고 자료

- [Troubleshooting](https://docs.unrealengine.com/troubleshooting/)
- [Performance Guidelines](https://docs.unrealengine.com/performance-guidelines/)
- [Debugging](https://docs.unrealengine.com/debugging/)
