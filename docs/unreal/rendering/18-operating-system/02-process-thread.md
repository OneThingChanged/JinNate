# 프로세스와 스레드

프로세스와 스레드의 구조, 생명주기를 설명합니다.

---

## 프로세스

```
┌─────────────────────────────────────────────────────────────────┐
│                    프로세스 구조                                 │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Process (실행 중인 프로그램)                                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                                                         │   │
│  │  ┌───────────────────────────────────────────────────┐ │   │
│  │  │              Virtual Address Space                 │ │   │
│  │  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐│ │   │
│  │  │  │  Code   │ │  Data   │ │  Heap   │ │  Stack  ││ │   │
│  │  │  │ (Text)  │ │(Global) │ │(Dynamic)│ │ (Local) ││ │   │
│  │  │  └─────────┘ └─────────┘ └─────────┘ └─────────┘│ │   │
│  │  └───────────────────────────────────────────────────┘ │   │
│  │                                                         │   │
│  │  ┌───────────────────────────────────────────────────┐ │   │
│  │  │              Process Control Block (PCB)           │ │   │
│  │  │  • PID (Process ID)                               │ │   │
│  │  │  • 상태 (Running, Ready, Waiting)                 │ │   │
│  │  │  • CPU 레지스터 값                                │ │   │
│  │  │  • 메모리 관리 정보                               │ │   │
│  │  │  • 열린 파일 목록                                 │ │   │
│  │  │  • 스케줄링 정보                                  │ │   │
│  │  └───────────────────────────────────────────────────┘ │   │
│  │                                                         │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 스레드

```
┌─────────────────────────────────────────────────────────────────┐
│                    스레드 구조                                   │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Process                                                        │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                                                         │   │
│  │  공유 자원:                                             │   │
│  │  ┌─────────────────────────────────────────────────┐   │   │
│  │  │  Code │ Data │ Heap │ Files │ Memory Mapping   │   │   │
│  │  └─────────────────────────────────────────────────┘   │   │
│  │                                                         │   │
│  │  스레드별 개별 자원:                                    │   │
│  │  ┌─────────┐  ┌─────────┐  ┌─────────┐              │   │
│  │  │Thread 1 │  │Thread 2 │  │Thread 3 │              │   │
│  │  │┌───────┐│  │┌───────┐│  │┌───────┐│              │   │
│  │  ││ Stack ││  ││ Stack ││  ││ Stack ││              │   │
│  │  │└───────┘│  │└───────┘│  │└───────┘│              │   │
│  │  │┌───────┐│  │┌───────┐│  │┌───────┐│              │   │
│  │  ││Regist.││  ││Regist.││  ││Regist.││              │   │
│  │  │└───────┘│  │└───────┘│  │└───────┘│              │   │
│  │  │   TLS   │  │   TLS   │  │   TLS   │              │   │
│  │  └─────────┘  └─────────┘  └─────────┘              │   │
│  │                                                         │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  TLS: Thread Local Storage                                     │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 프로세스 상태 전이

```
┌─────────────────────────────────────────────────────────────────┐
│                    프로세스 상태 다이어그램                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│                        ┌─────────┐                             │
│                        │   New   │                             │
│                        └────┬────┘                             │
│                             │ Admitted                         │
│                             ▼                                   │
│                        ┌─────────┐                             │
│              ┌─────────│  Ready  │◄────────────┐              │
│              │         └────┬────┘             │              │
│              │              │                   │              │
│    Interrupt │              │ Scheduler        │ I/O or       │
│              │              │ Dispatch         │ Event        │
│              │              ▼                   │ Complete     │
│              │         ┌─────────┐             │              │
│              └────────►│ Running │─────────────┤              │
│                        └────┬────┘             │              │
│                             │                   │              │
│            Exit             │ I/O or Event     │              │
│              │              │ Wait             │              │
│              ▼              ▼                   │              │
│         ┌─────────┐   ┌─────────┐             │              │
│         │Terminated│   │ Waiting │─────────────┘              │
│         └─────────┘   └─────────┘                             │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## Context Switch

```
┌─────────────────────────────────────────────────────────────────┐
│                    Context Switch                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Process A (Running)              Process B (Ready)            │
│       │                                │                        │
│       │ 1. 인터럽트/시스템콜          │                        │
│       ▼                                │                        │
│  ┌─────────┐                          │                        │
│  │ Save    │ 2. Process A 상태 저장   │                        │
│  │ State A │    (레지스터, PC, SP)    │                        │
│  └────┬────┘                          │                        │
│       │                                │                        │
│       │ 3. PCB A 업데이트             │                        │
│       │    (Running → Ready)          │                        │
│       │                                │                        │
│       │ 4. 스케줄러: 다음 프로세스 선택                        │
│       │                                │                        │
│       │                           ┌────┴────┐                  │
│       │                           │ Load    │ 5. Process B    │
│       │                           │ State B │    상태 복원    │
│       │                           └────┬────┘                  │
│       │                                │                        │
│       │                                │ 6. PCB B 업데이트     │
│       │                                │    (Ready → Running)  │
│       │                                ▼                        │
│  Process A (Ready)                Process B (Running)          │
│                                                                 │
│  Context Switch 비용:                                          │
│  • 직접 비용: 레지스터 저장/복원 (~1000 cycles)               │
│  • 간접 비용: 캐시/TLB 무효화 (수천~수만 cycles)              │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 스레드 종류

```
┌─────────────────────────────────────────────────────────────────┐
│                    스레드 모델                                   │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  1. User-Level Thread (1:N)                                    │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  User Space:  [T1] [T2] [T3] ─── User Thread Library   │   │
│  │                    │                                     │   │
│  │  Kernel Space:    [K1]         ─── 1 Kernel Thread     │   │
│  │                                                         │   │
│  │  + 빠른 Context Switch (커널 진입 불필요)               │   │
│  │  - 하나가 블록되면 전체 블록                           │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  2. Kernel-Level Thread (1:1) - Windows, Linux                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  User Space:  [T1] [T2] [T3]                            │   │
│  │                 │    │    │                              │   │
│  │  Kernel Space: [K1] [K2] [K3]                           │   │
│  │                                                         │   │
│  │  + 진정한 병렬 실행                                     │   │
│  │  + 개별 스레드 블록 가능                               │   │
│  │  - Context Switch 비용 높음                            │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  3. Hybrid (M:N)                                               │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  User Space:  [T1] [T2] [T3] [T4] [T5]                 │   │
│  │                  \   │   /      \   /                   │   │
│  │  Kernel Space:    [K1]  [K2]    [K3]                   │   │
│  │                                                         │   │
│  │  + 유연한 매핑                                          │   │
│  │  - 구현 복잡                                           │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 스케줄링 알고리즘

| 알고리즘 | 설명 | 장점 | 단점 |
|----------|------|------|------|
| FCFS | 먼저 온 순서대로 | 단순 | Convoy Effect |
| SJF | 짧은 작업 우선 | 최소 대기시간 | Starvation |
| Round Robin | 시간 할당량 | 공정 | Context Switch 오버헤드 |
| Priority | 우선순위 기반 | 유연 | Starvation |
| MLFQ | 다단계 피드백 큐 | 적응적 | 구현 복잡 |
| CFS | 완전 공정 스케줄러 | 공정 | 오버헤드 |

---

## 다음 단계

[동기화](03-synchronization.md)에서 스레드 간 협력을 알아봅니다.

