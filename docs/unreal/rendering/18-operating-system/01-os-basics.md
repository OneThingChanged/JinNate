# 운영체제 기초

OS의 정의, 역할, 구조를 설명합니다.

---

## 운영체제 정의

```
┌─────────────────────────────────────────────────────────────────┐
│                    운영체제란?                                   │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  운영체제 (Operating System):                                   │
│  • 하드웨어와 소프트웨어 사이의 중재자                         │
│  • 시스템 자원을 관리하고 분배                                 │
│  • 응용 프로그램에 실행 환경 제공                              │
│                                                                 │
│  주요 목표:                                                     │
│  1. 자원 관리 (Resource Management)                            │
│     - CPU, 메모리, 저장장치, I/O 장치                          │
│                                                                 │
│  2. 추상화 (Abstraction)                                       │
│     - 하드웨어 복잡성 숨김                                     │
│     - 일관된 인터페이스 제공                                   │
│                                                                 │
│  3. 보호 (Protection)                                          │
│     - 프로그램 간 격리                                         │
│     - 시스템 안정성 보장                                       │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 커널 모드 vs 유저 모드

```
┌─────────────────────────────────────────────────────────────────┐
│                    실행 모드                                     │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Ring 3 (User Mode)                                            │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  응용 프로그램                                           │   │
│  │  • 제한된 명령어만 실행 가능                            │   │
│  │  • 하드웨어 직접 접근 불가                              │   │
│  │  • 메모리 접근 제한                                     │   │
│  └─────────────────────────────────────────────────────────┘   │
│                             │                                   │
│                      System Call                                │
│                             │                                   │
│                             ▼                                   │
│  Ring 0 (Kernel Mode)                                          │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  운영체제 커널                                           │   │
│  │  • 모든 CPU 명령어 실행 가능                            │   │
│  │  • 모든 하드웨어 접근 가능                              │   │
│  │  • 전체 메모리 접근                                     │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  모드 전환이 필요한 작업:                                      │
│  • 파일 I/O                                                    │
│  • 네트워크 통신                                               │
│  • 메모리 할당/해제                                            │
│  • 프로세스/스레드 생성                                        │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 시스템 콜

```
┌─────────────────────────────────────────────────────────────────┐
│                    시스템 콜 과정                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Application                                                    │
│       │                                                         │
│       │ 1. 함수 호출 (예: fopen())                             │
│       ▼                                                         │
│  ┌─────────────────┐                                           │
│  │ C Runtime Lib   │  2. 파라미터 설정                         │
│  └────────┬────────┘                                           │
│           │                                                     │
│           │ 3. 시스템 콜 (예: NtCreateFile)                    │
│           ▼                                                     │
│  ════════════════════════════  Mode Transition  ════════════   │
│           │                                                     │
│           │ 4. 커널 진입                                       │
│           ▼                                                     │
│  ┌─────────────────┐                                           │
│  │   OS Kernel     │  5. 요청 처리                             │
│  └────────┬────────┘                                           │
│           │                                                     │
│           │ 6. 결과 반환                                       │
│           ▼                                                     │
│  ════════════════════════════  Mode Transition  ════════════   │
│           │                                                     │
│           ▼                                                     │
│  Application (결과 수신)                                        │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 시스템 콜 예시

```cpp
// Windows API
HANDLE hFile = CreateFile(
    "test.txt",
    GENERIC_READ,
    FILE_SHARE_READ,
    NULL,
    OPEN_EXISTING,
    FILE_ATTRIBUTE_NORMAL,
    NULL
);

// 내부적으로 시스템 콜 발생:
// User Mode: CreateFile()
//     → ntdll.dll: NtCreateFile()
//         → Kernel Mode: ZwCreateFile()
```

---

## 커널 아키텍처

```
┌─────────────────────────────────────────────────────────────────┐
│                    커널 타입                                     │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Monolithic Kernel (Linux):                                    │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    Kernel Space                          │   │
│  │  ┌─────────────────────────────────────────────────┐    │   │
│  │  │ Scheduler │ Memory │ File System │ Network │ ...│    │   │
│  │  └─────────────────────────────────────────────────┘    │   │
│  │  모든 서비스가 커널 공간에서 실행                        │   │
│  │  + 빠른 성능 (모드 전환 최소화)                         │   │
│  │  - 하나의 버그가 전체 시스템에 영향                     │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  Hybrid Kernel (Windows NT):                                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  User Space                                              │   │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐                   │   │
│  │  │ Win32   │ │ Services│ │ Drivers │                   │   │
│  │  │ Subsys  │ │         │ │ (일부)  │                   │   │
│  │  └─────────┘ └─────────┘ └─────────┘                   │   │
│  ├─────────────────────────────────────────────────────────┤   │
│  │  Kernel Space                                            │   │
│  │  ┌───────────────────────────────────────────────────┐  │   │
│  │  │ Executive │ HAL │ Kernel │ Drivers (핵심)         │  │   │
│  │  └───────────────────────────────────────────────────┘  │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 주요 OS 비교

| 특성 | Windows | Linux | macOS |
|------|---------|-------|-------|
| 커널 | NT Hybrid | Monolithic | XNU Hybrid |
| 스케줄러 | Multi-level Feedback Queue | CFS | Mach + BSD |
| 파일시스템 | NTFS | ext4, XFS | APFS |
| 프로세스 모델 | Thread 중심 | Process 중심 | Mach Task |
| 게임 지원 | DirectX 네이티브 | Vulkan, Proton | Metal |

---

## 다음 단계

[프로세스와 스레드](02-process-thread.md)에서 실행 단위를 알아봅니다.

