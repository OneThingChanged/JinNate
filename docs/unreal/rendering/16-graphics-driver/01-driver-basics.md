# 드라이버 기초

그래픽 드라이버의 기본 개념과 구조를 설명합니다.

---

## 드라이버의 역할

```
┌─────────────────────────────────────────────────────────────────┐
│                    드라이버 핵심 역할                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  1. 하드웨어 추상화                                             │
│     ┌─────────────────────────────────────────────────────┐    │
│     │  App: CreateTexture(1920, 1080, RGBA8)              │    │
│     │              │                                       │    │
│     │              ▼                                       │    │
│     │  Driver: 벤더별 GPU 명령으로 변환                   │    │
│     │              │                                       │    │
│     │              ▼                                       │    │
│     │  GPU: 실제 메모리 할당, 텍스처 생성                 │    │
│     └─────────────────────────────────────────────────────┘    │
│                                                                 │
│  2. 리소스 관리                                                 │
│     • GPU 메모리 할당/해제                                     │
│     • 가상 주소 매핑                                           │
│     • 스와핑 (VRAM ↔ System RAM)                              │
│                                                                 │
│  3. 명령 처리                                                   │
│     • 커맨드 버퍼 검증                                         │
│     • GPU 큐 스케줄링                                          │
│     • 동기화 관리                                              │
│                                                                 │
│  4. 전력/성능 관리                                              │
│     • 클럭 주파수 조절                                         │
│     • 전압 제어                                                │
│     • 열 관리                                                  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## User-Mode vs Kernel-Mode

```
┌─────────────────────────────────────────────────────────────────┐
│                    드라이버 모드 분리                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  User Mode:                                                     │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  • DLL로 실행                                           │   │
│  │  • 애플리케이션 컨텍스트에서 동작                       │   │
│  │  • 크래시 시 해당 앱만 영향                             │   │
│  │                                                         │   │
│  │  역할:                                                  │   │
│  │  ├── API 호출 처리                                     │   │
│  │  ├── 셰이더 컴파일                                     │   │
│  │  ├── 명령 버퍼 구성                                    │   │
│  │  └── 리소스 상태 추적                                  │   │
│  └─────────────────────────────────────────────────────────┘   │
│                          │                                      │
│                     시스템 콜                                   │
│                          │                                      │
│  Kernel Mode:                                                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  • 커널 드라이버로 실행                                 │   │
│  │  • 높은 권한                                            │   │
│  │  • 크래시 시 시스템 전체 영향 가능                      │   │
│  │                                                         │   │
│  │  역할:                                                  │   │
│  │  ├── 물리 메모리 관리                                  │   │
│  │  ├── GPU 하드웨어 접근                                 │   │
│  │  ├── 인터럽트 처리                                     │   │
│  │  └── 다중 앱 스케줄링                                  │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 명령 검증

보안을 위해 드라이버는 모든 GPU 명령을 검증합니다.

```
┌─────────────────────────────────────────────────────────────────┐
│                    명령 검증 과정                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Application                                                    │
│      │ DrawIndexed(1000, 0)                                    │
│      ▼                                                          │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  User-Mode Driver                                       │   │
│  │                                                         │   │
│  │  검증:                                                  │   │
│  │  ✓ Index Buffer 바운드 확인                            │   │
│  │  ✓ Vertex Buffer 바운드 확인                           │   │
│  │  ✓ Pipeline State 유효성                               │   │
│  │  ✓ 인덱스 범위 확인                                    │   │
│  └─────────────────────────────────────────────────────────┘   │
│      │                                                          │
│      ▼                                                          │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  Kernel-Mode Driver                                     │   │
│  │                                                         │   │
│  │  검증:                                                  │   │
│  │  ✓ 메모리 주소 유효성 (DMA 보호)                       │   │
│  │  ✓ 권한 확인                                           │   │
│  │  ✓ 리소스 소유권                                       │   │
│  └─────────────────────────────────────────────────────────┘   │
│      │                                                          │
│      ▼                                                          │
│     GPU                                                         │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 다음 단계

[OS 계층](02-os-layer.md)에서 Windows WDDM과 Linux DRM을 알아봅니다.
