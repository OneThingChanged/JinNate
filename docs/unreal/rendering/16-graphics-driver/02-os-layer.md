# OS 계층

Windows WDDM과 Linux DRM 구조를 설명합니다.

---

## Windows WDDM

### WDDM 발전

| 버전 | OS | 주요 변경 |
|------|-----|----------|
| **1.0** | Vista | DWM 도입, User/Kernel 분리 |
| **1.2** | Windows 8 | XP 지원 제거 |
| **2.0** | Windows 10 | 가상화 지원 |
| **2.7** | Windows 10 (2020) | 하드웨어 스케줄링 |

### WDDM 아키텍처

```
┌─────────────────────────────────────────────────────────────────┐
│                    WDDM 아키텍처                                 │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  User Mode:                                                     │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  Application                                             │   │
│  │      │                                                   │   │
│  │      ▼                                                   │   │
│  │  D3D Runtime (d3d12.dll)                                │   │
│  │      │                                                   │   │
│  │      ▼                                                   │   │
│  │  User-Mode Driver (vendor UMD)                          │   │
│  └─────────────────────────────────────────────────────────┘   │
│                          │                                      │
│  ────────────────────────┼───────────────────────────────────  │
│                          │ (IOCTL)                             │
│  Kernel Mode:                                                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  DXGKRNL.sys (DirectX Graphics Kernel)                  │   │
│  │      │                                                   │   │
│  │      ▼                                                   │   │
│  │  Video Scheduler                                         │   │
│  │      │                                                   │   │
│  │      ▼                                                   │   │
│  │  Kernel-Mode Driver (vendor KMD)                        │   │
│  └─────────────────────────────────────────────────────────┘   │
│                          │                                      │
│                          ▼                                      │
│                        GPU                                      │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 하드웨어 스케줄링 (WDDM 2.7+)

```
┌─────────────────────────────────────────────────────────────────┐
│                    하드웨어 스케줄링                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  기존 (소프트웨어 스케줄링):                                    │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  CPU (DXGKRNL)                                          │   │
│  │      │                                                   │   │
│  │      ▼ 스케줄링 결정                                    │   │
│  │      │                                                   │   │
│  │      ▼ 명령 전송                                        │   │
│  │     GPU                                                  │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  신규 (하드웨어 스케줄링):                                      │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  CPU: 우선순위만 설정                                   │   │
│  │      │                                                   │   │
│  │      ▼                                                   │   │
│  │  GPU 스케줄링 프로세서: 실제 스케줄링 수행             │   │
│  │      │                                                   │   │
│  │      ▼                                                   │   │
│  │  GPU 코어: 작업 실행                                    │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  장점:                                                          │
│  • CPU 오버헤드 감소                                           │
│  • 제출 지연 감소                                              │
│  • 컨텍스트 스위칭 비용 감소                                   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## Linux DRM/DRI

### DRI/DRM 아키텍처

```
┌─────────────────────────────────────────────────────────────────┐
│                    Linux 그래픽 스택                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  User Space:                                                    │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  Application (OpenGL / Vulkan)                          │   │
│  │      │                                                   │   │
│  │      ▼                                                   │   │
│  │  Mesa3D / Vendor Driver                                 │   │
│  │      │                                                   │   │
│  │      ▼                                                   │   │
│  │  libdrm (DRM 라이브러리)                                │   │
│  └─────────────────────────────────────────────────────────┘   │
│                          │                                      │
│  ────────────────────────┼───────────────────────────────────  │
│                          │ (ioctl)                             │
│  Kernel Space:                                                  │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  DRM Core (/dev/dri/card0)                              │   │
│  │      │                                                   │   │
│  │      ▼                                                   │   │
│  │  KMS (Kernel Mode Setting)                              │   │
│  │      │                                                   │   │
│  │      ▼                                                   │   │
│  │  GPU Driver (nouveau, amdgpu, i915)                     │   │
│  └─────────────────────────────────────────────────────────┘   │
│                          │                                      │
│                          ▼                                      │
│                        GPU                                      │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### DRM 핵심 기능

| 기능 | 설명 |
|------|------|
| **GEM** | Graphics Execution Manager - 버퍼 관리 |
| **KMS** | Kernel Mode Setting - 디스플레이 모드 |
| **TTM** | Translation Table Maps - 메모리 관리 |
| **DMA-BUF** | 버퍼 공유 메커니즘 |

---

## 다음 단계

[벤더별 드라이버](03-vendor-drivers.md)에서 NVIDIA, AMD, Intel 드라이버를 알아봅니다.
