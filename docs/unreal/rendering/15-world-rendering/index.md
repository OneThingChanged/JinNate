# Ch.15 월드 렌더링

대규모 월드 환경을 효율적으로 렌더링하기 위한 시스템들을 분석합니다.

---

## 개요

오픈 월드 게임에서는 광활한 환경을 효율적으로 관리하고 렌더링해야 합니다. UE5는 이를 위한 다양한 시스템을 제공합니다.

```
┌─────────────────────────────────────────────────────────────────┐
│                    월드 렌더링 시스템 구조                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    World Partition                       │   │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐        │   │
│  │  │ Cell A  │ │ Cell B  │ │ Cell C  │ │ Cell D  │  ...   │   │
│  │  └────┬────┘ └────┬────┘ └────┬────┘ └────┬────┘        │   │
│  └───────┼──────────┼──────────┼──────────┼────────────────┘   │
│          │          │          │          │                     │
│          ▼          ▼          ▼          ▼                     │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                   Streaming System                       │   │
│  │  • Distance-based Loading                                │   │
│  │  • Priority Queue                                        │   │
│  │  • Async Loading                                         │   │
│  └─────────────────────────────────────────────────────────┘   │
│                              │                                  │
│          ┌───────────────────┼───────────────────┐             │
│          ▼                   ▼                   ▼             │
│  ┌──────────────┐   ┌──────────────┐   ┌──────────────┐        │
│  │  Landscape   │   │   Foliage    │   │    HLOD      │        │
│  │   System     │   │   System     │   │   System     │        │
│  ├──────────────┤   ├──────────────┤   ├──────────────┤        │
│  │ • Components │   │ • Instancing │   │ • Proxy Mesh │        │
│  │ • LOD        │   │ • Culling    │   │ • Clustering │        │
│  │ • Collision  │   │ • LOD        │   │ • Streaming  │        │
│  └──────────────┘   └──────────────┘   └──────────────┘        │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 핵심 시스템

### 1. 랜드스케이프 시스템

대규모 지형을 효율적으로 렌더링:

| 기능 | 설명 |
|------|------|
| **Component 기반** | 지형을 컴포넌트 단위로 분할 |
| **LOD 시스템** | 거리 기반 테셀레이션 |
| **레이어 페인팅** | 다중 머티리얼 블렌딩 |
| **Virtual Texture** | 대규모 텍스처 스트리밍 |

### 2. 폴리지 시스템

수백만 개의 식생을 효율적으로 렌더링:

| 기능 | 설명 |
|------|------|
| **GPU Instancing** | 동일 메시 대량 렌더링 |
| **HISM** | Hierarchical Instanced Static Mesh |
| **Culling** | 거리/절두체/오클루전 컬링 |
| **Wind Animation** | 셰이더 기반 바람 효과 |

### 3. 레벨 스트리밍

동적 콘텐츠 로딩/언로딩:

| 기능 | 설명 |
|------|------|
| **Level Streaming** | 서브레벨 동적 로딩 |
| **World Partition** | 셀 기반 자동 스트리밍 |
| **Data Layers** | 레이어별 콘텐츠 관리 |
| **Async Loading** | 비동기 에셋 로딩 |

### 4. HLOD 시스템

원거리 오브젝트 최적화:

| 기능 | 설명 |
|------|------|
| **Proxy Mesh** | 다수 메시를 단일 메시로 병합 |
| **Imposter** | 빌보드 기반 표현 |
| **Clustering** | 공간 기반 그룹화 |
| **LOD 전환** | 부드러운 전환 처리 |

---

## 렌더링 파이프라인 통합

```
┌─────────────────────────────────────────────────────────────────┐
│                   월드 렌더링 파이프라인                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Frame Start                                                    │
│       │                                                         │
│       ▼                                                         │
│  ┌─────────────────────────────────────────┐                   │
│  │         Streaming Update                │                   │
│  │  • Cell 가시성 업데이트                   │                   │
│  │  • 스트리밍 우선순위 계산                 │                   │
│  │  • 로드/언로드 요청                       │                   │
│  └────────────────┬────────────────────────┘                   │
│                   │                                             │
│                   ▼                                             │
│  ┌─────────────────────────────────────────┐                   │
│  │         Visibility Culling              │                   │
│  │  • Frustum Culling                      │                   │
│  │  • Distance Culling                     │                   │
│  │  • Occlusion Culling                    │                   │
│  └────────────────┬────────────────────────┘                   │
│                   │                                             │
│       ┌───────────┼───────────┐                                │
│       ▼           ▼           ▼                                │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐                           │
│  │Landscape│ │ Foliage │ │  HLOD   │                           │
│  │ Render  │ │ Render  │ │ Render  │                           │
│  └────┬────┘ └────┬────┘ └────┬────┘                           │
│       │           │           │                                 │
│       └───────────┼───────────┘                                │
│                   ▼                                             │
│  ┌─────────────────────────────────────────┐                   │
│  │         Scene Rendering                 │                   │
│  │  • BasePass                             │                   │
│  │  • Shadow Pass                          │                   │
│  │  • Lighting Pass                        │                   │
│  └─────────────────────────────────────────┘                   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## UE5 주요 개선사항

### World Partition

| 기능 | 설명 |
|------|------|
| **One File Per Actor** | 액터별 개별 파일 저장 |
| **Runtime Grid** | 런타임 셀 기반 스트리밍 |
| **Data Layers** | 게임플레이 기반 레이어 |
| **Level Instances** | 재사용 가능한 레벨 인스턴스 |

### Nanite 통합

| 기능 | 설명 |
|------|------|
| **Nanite Landscape** | 지형에 Nanite 적용 (UE5.3+) |
| **Nanite Foliage** | 폴리지에 Nanite 적용 |
| **Virtual Geometry** | 지오메트리 가상화 |

---

## 문서 구성

| 문서 | 내용 |
|------|------|
| [랜드스케이프 시스템](01-landscape-system.md) | 지형 렌더링 구조와 최적화 |
| [폴리지 렌더링](02-foliage-rendering.md) | 대규모 식생 렌더링 기법 |
| [레벨 스트리밍](03-level-streaming.md) | 동적 콘텐츠 로딩 시스템 |
| [HLOD 시스템](04-hlod-system.md) | 원거리 LOD 최적화 |
| [월드 파티션](05-world-partition.md) | UE5 월드 관리 시스템 |

---

## 성능 목표

### 오픈 월드 타겟

| 항목 | 목표 |
|------|------|
| **Draw Calls** | < 3000 (월드 오브젝트) |
| **Triangle Count** | 가변 (Nanite) |
| **Streaming** | 히칭 없음 |
| **Memory** | 예산 내 VRAM 사용 |

### 최적화 전략

```
┌─────────────────────────────────────────────────────────────────┐
│                     최적화 우선순위                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  1. Culling 최적화                                              │
│     └── 불필요한 오브젝트 조기 제거                               │
│                                                                 │
│  2. Instancing 활용                                             │
│     └── 동일 메시 배칭                                           │
│                                                                 │
│  3. LOD/HLOD 설정                                               │
│     └── 거리별 적절한 디테일                                     │
│                                                                 │
│  4. Streaming 튜닝                                              │
│     └── 히칭 없는 로딩/언로딩                                    │
│                                                                 │
│  5. Nanite 활용 (UE5)                                           │
│     └── 지오메트리 복잡도 해결                                   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 참고 자료

- [Unreal Engine Landscape 문서](https://docs.unrealengine.com/landscape/)
- [World Partition 문서](https://docs.unrealengine.com/world-partition/)
- [Foliage 문서](https://docs.unrealengine.com/foliage/)
